public with sharing class PartsController {
    
    // λ¶€ν’ μ •λ³΄λ¥Ό λ‹΄λ” λνΌ ν΄λμ¤
    public class PartWrapper {
        @AuraEnabled public Id Id;
        @AuraEnabled public String Name;
        @AuraEnabled public Decimal Price;
        @AuraEnabled public String PartsClassification;
        @AuraEnabled public Decimal Quantity;
        @AuraEnabled public Decimal InvertoryRate;
        @AuraEnabled public String ImageURL;
        
        public PartWrapper(Id id, String name, Decimal price, String partsClassification, 
                          Decimal quantity, Decimal invertoryRate, String imageURL) {
            this.Id = id;
            this.Name = name;
            this.Price = price;
            this.PartsClassification = partsClassification;
            this.Quantity = quantity;
            this.InvertoryRate = invertoryRate;
            this.ImageURL = imageURL;
        }
    }
    
    /**
     * λ¨λ“  λ¶€ν’ μ •λ³΄λ¥Ό μ¬κ³ μ¨ λ‚®μ€ μμ„λ΅ μ΅°νν•©λ‹λ‹¤.
     * @return λ¶€ν’ μ •λ³΄ λ¦¬μ¤νΈ (μ¬κ³ μ¨ λ‚®μ€ μμ„)
     */
    @AuraEnabled(cacheable=true)
    public static List<PartWrapper> getVehicleParts() {
        List<PartWrapper> results = new List<PartWrapper>();
        
        try {
            // λ¨λ“  λ¶€ν’ μ΅°ν (κ²€μƒ‰ κΈ°λ¥μ„ μ„ν•΄)
            List<Parts__c> parts = [
                SELECT Id, Name, Quantity__c, Price__c, PartsClassification__c, InvertoryRate__c, imageURL__c
                FROM Parts__c 
                ORDER BY InvertoryRate__c ASC NULLS LAST
            ];
            
            for (Parts__c part : parts) {
                results.add(new PartWrapper(
                    part.Id,
                    part.Name,
                    part.Price__c != null ? part.Price__c : 0,
                    part.PartsClassification__c != null ? part.PartsClassification__c : 'Unknown',
                    part.Quantity__c != null ? part.Quantity__c : 0,
                    part.InvertoryRate__c != null ? part.InvertoryRate__c : 0,
                    part.imageURL__c
                ));
            }
            
            System.debug('π” [PartsController] μ΅°νλ λ¶€ν’ μ: ' + results.size());
            
        } catch (Exception e) {
            System.debug('β [PartsController] μ¤λ¥: ' + e.getMessage());
            throw new AuraHandledException('λ¶€ν’ μ •λ³΄λ¥Ό μ΅°νν•λ” μ¤‘ μ¤λ¥κ°€ λ°μƒν–μµλ‹λ‹¤: ' + e.getMessage());
        }
        
        return results;
    }
    
    /**
     * νΉμ • λ¶€ν’μ μƒμ„Έ μ •λ³΄λ¥Ό μ΅°νν•©λ‹λ‹¤.
     * @param partId λ¶€ν’ ID
     * @return λ¶€ν’ μƒμ„Έ μ •λ³΄
     */
    @AuraEnabled(cacheable=true)
    public static PartWrapper getPartDetails(Id partId) {
        try {
            // μ‹¤μ  κµ¬ν„μ‹μ—λ” μ»¤μ¤ν…€ κ°μ²΄μ—μ„ μ΅°ν
            /*
            Parts__c part = [
                SELECT Id, Name, Price__c, PartsClassification__c, Quantity__c, InvertoryRate__c, imageURL__c
                FROM Parts__c 
                WHERE Id = :partId
                LIMIT 1
            ];
            
            return new PartWrapper(
                part.Id,
                part.Name,
                part.Price__c,
                part.PartsClassification__c,
                part.Quantity__c,
                part.InvertoryRate__c,
                part.imageURL__c
            );
            */
            
            // μƒν” λ°μ΄ν„°
            return new PartWrapper(
                partId,
                'μƒν” λ¶€ν’',
                100000,
                'EngineMotor',
                50,
                80.0,
                null
            );
            
        } catch (Exception e) {
            System.debug('β [PartsController] λ¶€ν’ μƒμ„Έ μ΅°ν μ¤λ¥: ' + e.getMessage());
            throw new AuraHandledException('λ¶€ν’ μƒμ„Έ μ •λ³΄λ¥Ό μ΅°νν•λ” μ¤‘ μ¤λ¥κ°€ λ°μƒν–μµλ‹λ‹¤: ' + e.getMessage());
        }
    }
    
    /**
     * λ¶€ν’ μ¬κ³ λ¥Ό μ—…λ°μ΄νΈν•©λ‹λ‹¤.
     * @param partId λ¶€ν’ ID
     * @param newQuantity μƒλ΅μ΄ μ¬κ³  μλ‰
     * @return μ—…λ°μ΄νΈ μ„±κ³µ μ—¬λ¶€
     */
    @AuraEnabled
    public static Boolean updatePartStock(Id partId, Integer newQuantity) {
        try {
            // μ‹¤μ  κµ¬ν„μ‹μ—λ” μ»¤μ¤ν…€ κ°μ²΄ μ—…λ°μ΄νΈ
            /*
            Parts__c part = [SELECT Id, Quantity__c FROM Parts__c WHERE Id = :partId LIMIT 1];
            part.Quantity__c = newQuantity;
            update part;
            */
            
            System.debug('π”„ [PartsController] λ¶€ν’ μ¬κ³  μ—…λ°μ΄νΈ: ' + partId + ' -> ' + newQuantity);
            return true;
            
        } catch (Exception e) {
            System.debug('β [PartsController] μ¬κ³  μ—…λ°μ΄νΈ μ¤λ¥: ' + e.getMessage());
            throw new AuraHandledException('λ¶€ν’ μ¬κ³ λ¥Ό μ—…λ°μ΄νΈν•λ” μ¤‘ μ¤λ¥κ°€ λ°μƒν–μµλ‹λ‹¤: ' + e.getMessage());
        }
    }
}